<!DOCTYPE html>
<html>
<head>
    <title>单词选择页</title>
</head>
<body>
    <h1>选择单词组进行测试</h1>
    <div id="groups"></div>
    <div id="history"></div>
    <script>
        const db = firebase.firestore();

        function loadGroups() {
            db.collection('words').get().then(snapshot => {
                const words = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const groups = [];
                for (let i = 0; i < words.length; i += 150) {
                    groups.push(words.slice(i, i + 150));
                }
                displayGroups(groups);
            });
        }

        function displayGroups(groups) {
            const groupsDiv = document.getElementById('groups');
            groups.forEach((group, index) => {
                const groupDiv = document.createElement('div');
                groupDiv.innerHTML = `
                    <h2>第${index + 1}组</h2>
                    <p>单词总数: ${group.length}</p>
                    <p>已测试单词数量: ${group.filter(word => word.tested > 0).length}</p>
                    <p>未测试单词数量: ${group.filter(word => word.tested === 0).length}</p>
                    <p>上一次测试时间: ${group.map(word => word.lastTested).sort((a, b) => b - a)[0] || '无'}</p>
                    <button onclick="startTest(${index})">开始测试</button>
                `;
                groupsDiv.appendChild(groupDiv);
            });
        }

        function loadHistory() {
            db.collection('words').get().then(snapshot => {
                const words = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const neverTested = words.filter(word => word.tested === 0);
                const errorsMoreThanOnce = words.filter(word => word.errors > 1);
                const errorsMoreThanThree = words.filter(word => word.errors > 3);

                displayHistory('从未测试单词', neverTested);
                displayHistory('测试单词错误次数超过1次', errorsMoreThanOnce);
                displayHistory('测试单词错误次数超过3次', errorsMoreThanThree);
            });
        }

        function displayHistory(title, words) {
            const historyDiv = document.getElementById('history');
            const sectionDiv = document.createElement('div');
            sectionDiv.innerHTML = `<h2>${title}</h2><p>单词数量: ${words.length}</p><button onclick="startTestHistory('${title}')">开始测试</button>`;
            historyDiv.appendChild(sectionDiv);
        }

        function startTest(groupIndex) {
            localStorage.setItem('currentGroup', groupIndex);
            window.location.href = 'spelling.html';
        }

        function startTestHistory(title) {
            localStorage.setItem('currentHistory', title);
            window.location.href = 'spelling.html';
        }

        loadGroups();
        loadHistory();
    </script>
    <!-- Firebase 配置 -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
    </script>
</body>
</html>
