<!DOCTYPE html>
<html>
<head>
  <title>Spelling Test</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
    import { getDatabase, ref, get } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js';
    import firebaseConfig from './firebaseConfig.js';

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    let currentWordIndex = 0;
    let words = [];

    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const groupNumber = urlParams.get('group');
      const wordListRef = ref(database, 'wordlist');
      get(wordListRef).then(snapshot => {
        const allWords = snapshot.val() || [];
        const groupWords = allWords.slice((groupNumber - 1) * 100, groupNumber * 100);
        words = groupWords.map((word, index) => ({ word, index }));
        words.sort((a, b) => a.index - b.index);
        displayWord();
      });
    });

    function displayWord() {
      const word = words[currentWordIndex].word;
      const utterance = new SpeechSynthesisUtterance(word);
      speechSynthesis.speak(utterance);
      document.getElementById('wordNumber').innerText = `Word ${currentWordIndex + 1} of ${words.length}`;
    }

    function checkSpelling() {
      const input = document.getElementById('spellingInput').value.trim();
      const word = words[currentWordIndex].word;
      if (input === word) {
        document.getElementById('result').innerText = 'Correct!';
        currentWordIndex++;
        if (currentWordIndex < words.length) {
          displayWord();
        } else {
          document.getElementById('result').innerText = 'Test completed!';
        }
      } else {
        document.getElementById('result').innerText = `Incorrect! The correct spelling is ${word}`;
      }
    }
  </script>
</head>
<body>
  <h1>Spelling Test</h1>
  <p id="wordNumber"></p>
  <button onclick="displayWord()">Play Word</button>
  <input type="text" id="spellingInput">
  <button onclick="checkSpelling()">Check</button>
  <p id="result"></p>
</body>
</html>
